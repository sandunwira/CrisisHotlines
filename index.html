<!DOCTYPE html>
<html>

<head>
	<title>CrisisHotlines</title>
	<link rel="stylesheet" type="text/css" href="style.css">
	<script src="script.js" defer></script>

	<link rel="icon" href="favicon.png">
</head>

<body>
	<header>
		<div class="containerBlock flex" style="padding: 25px 50px; border: none;">
			<div class="container">
				<nav class="flex flexRow" style="justify-content: space-between;">
					<a href="" class="flex flexRow" style="gap: 5px;">
						<img src="favicon.png" alt="CrisisHotlines" style="width: 20px; height: 20px;">
						<h1>CrisisHotlines</h1>
					</a>

					<div class="flex flexRow" style="gap: 20px;">
						<span class="flex flexRow"
							style="font-size: 12px; font-weight: 500; text-transform: uppercase; gap: 5px; user-select: none; padding: 5px 8px; background: #FFFFFF; border-radius: 6px;">
							<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"
								fill="currentColor" class="icon icon-tabler icons-tabler-filled icon-tabler-map-pin">
								<path stroke="none" d="M0 0h24v24H0z" fill="none" />
								<path
									d="M18.364 4.636a9 9 0 0 1 .203 12.519l-.203 .21l-4.243 4.242a3 3 0 0 1 -4.097 .135l-.144 -.135l-4.244 -4.243a9 9 0 0 1 12.728 -12.728zm-6.364 3.364a3 3 0 1 0 0 6a3 3 0 0 0 0 -6z" />
							</svg>
							<span id="locatedCountry">Fetching ...</span>
						</span>

						<a href="https://github.com/sandunwira/CrisisHotlines" target="_blank" class="flex flexRow"
							style="gap: 5px;">
							<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
								fill="currentColor"
								class="icon icon-tabler icons-tabler-filled icon-tabler-brand-github">
								<path stroke="none" d="M0 0h24v24H0z" fill="none" />
								<path
									d="M5.315 2.1c.791 -.113 1.9 .145 3.333 .966l.272 .161l.16 .1l.397 -.083a13.3 13.3 0 0 1 4.59 -.08l.456 .08l.396 .083l.161 -.1c1.385 -.84 2.487 -1.17 3.322 -1.148l.164 .008l.147 .017l.076 .014l.05 .011l.144 .047a1 1 0 0 1 .53 .514a5.2 5.2 0 0 1 .397 2.91l-.047 .267l-.046 .196l.123 .163c.574 .795 .93 1.728 1.03 2.707l.023 .295l.007 .272c0 3.855 -1.659 5.883 -4.644 6.68l-.245 .061l-.132 .029l.014 .161l.008 .157l.004 .365l-.002 .213l-.003 3.834a1 1 0 0 1 -.883 .993l-.117 .007h-6a1 1 0 0 1 -.993 -.883l-.007 -.117v-.734c-1.818 .26 -3.03 -.424 -4.11 -1.878l-.535 -.766c-.28 -.396 -.455 -.579 -.589 -.644l-.048 -.019a1 1 0 0 1 .564 -1.918c.642 .188 1.074 .568 1.57 1.239l.538 .769c.76 1.079 1.36 1.459 2.609 1.191l.001 -.678l-.018 -.168a5.03 5.03 0 0 1 -.021 -.824l.017 -.185l.019 -.12l-.108 -.024c-2.976 -.71 -4.703 -2.573 -4.875 -6.139l-.01 -.31l-.004 -.292a5.6 5.6 0 0 1 .908 -3.051l.152 -.222l.122 -.163l-.045 -.196a5.2 5.2 0 0 1 .145 -2.642l.1 -.282l.106 -.253a1 1 0 0 1 .529 -.514l.144 -.047l.154 -.03z" />
							</svg>
						</a>
					</div>
				</nav>
			</div>
		</div>
	</header>

	<div class="containerBlock flex">
		<div class="container flex flexCol" style="gap: 50px;">
			<div class="flex flexCol" style="gap: 15px;">
				<h2 style="color: var(--black); font-size: 34px;">Find a helpline</h2>
				<p style="color: var(--black);">Search for a helpline by country</p>
			</div>

			<div class="flex flexCol" style="gap: 15px;">
				<div class="flex flexRow" style="gap: 15px;">
					<input type="text" placeholder="Search by country" id="searchField">
					<button type="button" id="searchBtn">Search</button>
				</div>
			</div>
		</div>
	</div>

	<div class="containerBlock flex">
		<div class="container flex flexCol" style="gap: 50px;">
			<div class="flex flexCol" style="gap: 15px;">
				<h2 style="color: var(--black);">Available helplines</h2>
				<p style="color: var(--black);" id="resultsCount">Fetching helplines</p>
			</div>

			<div class="flex flexCol" style="gap: 10px; width: 100%;" id="hotlineCardsContainer">
				<div class="flex flexRow" style="color: var(--gray); font-size: 18px; gap: 10px; align-items: center;">
					Loading
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
						stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
						class="icon icon-tabler icons-tabler-outline icon-tabler-loader-2 spinner">
						<path stroke="none" d="M0 0h24v24H0z" fill="none" />
						<path d="M12 3a9 9 0 1 0 9 9" />
					</svg>
				</div>
			</div>
		</div>
	</div>


	<script>
		const searchField = document.getElementById('searchField');
		const searchBtn = document.getElementById('searchBtn');
		const hotlineCardsContainer = document.getElementById('hotlineCardsContainer');
		const resultsCount = document.getElementById('resultsCount');
		const locatedCountry = document.getElementById('locatedCountry');

		async function getIPAddress() {
			return fetch('https://ipinfo.io/?token=a6384bf1fee5c5')
				.then(response => response.json())
				.then(data => {
					const ipaddress = data.ip;
					const country = data.country;
					locatedCountry.textContent = country;
					return country;
				})
				.catch(error => {
					console.error('Error in getIPAddress:', error);
					throw error;
				});
		}

		getIPAddress();


		let helplinesData = [];

		async function getHelplines() {
			return fetch('information.min.json')
				.then(response => response.json())
				.then(data => {
					helplinesData = data;
					console.log('Helplines Data:', helplinesData);
					return helplinesData;
				})
				.catch(error => {
					console.error('Error in getHelplines:', error);
					throw error;
				});
		}

		getHelplines();


		async function getHelplinesByCountry() {
			const country = await getIPAddress();
			const filteredHelplines = helplinesData.filter(helpline => {
				return helpline['alpha-2'].toLowerCase() === country.toLowerCase();
			});

			// Calculate total hotlines and numbers
			const totalHotlines = filteredHelplines.reduce((sum, country) => {
				return sum + country.hotlines.reduce((numberSum, hotline) => {
					return numberSum + hotline.numbers.length;
				}, 0);
			}, 0);

			// Update display text
			resultsCount.textContent = `Found ${totalHotlines} helplines in ${filteredHelplines[0].country}`;

			console.log('Filtered Helplines:', filteredHelplines);

			// Clear container
			hotlineCardsContainer.innerHTML = '';

			// Generate cards
			filteredHelplines.forEach(helpline => {
				helpline.hotlines.forEach(hotline => {
					hotline.numbers.forEach(number => {
						const hotlineCard = document.createElement('div');
						hotlineCard.classList.add('hotlineCard', 'flex', 'flexRow');

						hotlineCard.innerHTML = `
							<span class="flex flexCol" style="width: 70%; align-items: flex-start; gap: 10px;">
								<h3>${hotline.name}</h3>
								<span class="flex flexRow"
									style="font-size: 12px; font-weight: 500; text-transform: uppercase; gap: 5px; user-select: none; padding: 5px 8px; background: #ECECEC; border-radius: 6px;">
									<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"
										fill="currentColor" class="icon icon-tabler icons-tabler-filled icon-tabler-map-pin">
										<path stroke="none" d="M0 0h24v24H0z" fill="none" />
										<path
											d="M18.364 4.636a9 9 0 0 1 .203 12.519l-.203 .21l-4.243 4.242a3 3 0 0 1 -4.097 .135l-.144 -.135l-4.244 -4.243a9 9 0 0 1 12.728 -12.728zm-6.364 3.364a3 3 0 1 0 0 6a3 3 0 0 0 0 -6z" />
									</svg>
									<span>${helpline['country']}</span>
								</span>
							</span>
							<a href="tel:${number}" class="flex flexRow" style="gap: 8px;">
								<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-phone-outgoing">
									<path stroke="none" d="M0 0h24v24H0z" fill="none" />
									<path d="M5 4h4l2 5l-2.5 1.5a11 11 0 0 0 5 5l1.5 -2.5l5 2v4a2 2 0 0 1 -2 2c-8.072 -.49 -14.51 -6.928 -15 -15a2 2 0 0 1 2 -2" />
									<path d="M15 5h6" />
									<path d="M18.5 7.5l2.5 -2.5l-2.5 -2.5" />
								</svg>
								${number}
							</a>
						`;

						hotlineCardsContainer.appendChild(hotlineCard);
					});
				});
			});
		}

		getHelplinesByCountry();


		searchBtn.addEventListener('click', () => {
			const searchValue = searchField.value;
			console.log('Search Value:', searchValue);

			const filteredHelplines = helplinesData.filter(helpline => {
				return helpline.country.toLowerCase().includes(searchValue.toLowerCase());
			});

			// Calculate total hotlines and numbers
			const totalHotlines = filteredHelplines.reduce((sum, country) => {
				return sum + country.hotlines.reduce((numberSum, hotline) => {
					return numberSum + hotline.numbers.length;
				}, 0);
			}, 0);

			// Update display text
			resultsCount.textContent = `Found ${totalHotlines} results for "${searchValue}"`;

			console.log('Filtered Helplines:', filteredHelplines);

			// Clear container
			hotlineCardsContainer.innerHTML = '';

			// Generate cards
			filteredHelplines.forEach(helpline => {
				helpline.hotlines.forEach(hotline => {
					hotline.numbers.forEach(number => {
						const hotlineCard = document.createElement('div');
						hotlineCard.classList.add('hotlineCard', 'flex', 'flexRow');

						hotlineCard.innerHTML = `
							<span class="flex flexCol" style="width: 70%; align-items: flex-start; gap: 10px;">
								<h3>${hotline.name}</h3>
								<span class="flex flexRow"
									style="font-size: 12px; font-weight: 500; text-transform: uppercase; gap: 5px; user-select: none; padding: 5px 8px; background: #ECECEC; border-radius: 6px;">
									<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"
										fill="currentColor" class="icon icon-tabler icons-tabler-filled icon-tabler-map-pin">
										<path stroke="none" d="M0 0h24v24H0z" fill="none" />
										<path
											d="M18.364 4.636a9 9 0 0 1 .203 12.519l-.203 .21l-4.243 4.242a3 3 0 0 1 -4.097 .135l-.144 -.135l-4.244 -4.243a9 9 0 0 1 12.728 -12.728zm-6.364 3.364a3 3 0 1 0 0 6a3 3 0 0 0 0 -6z" />
									</svg>
									<span>${helpline['country']}</span>
								</span>
							</span>
							<a href="tel:${number}" class="flex flexRow" style="gap: 8px;">
								<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-phone-outgoing">
									<path stroke="none" d="M0 0h24v24H0z" fill="none" />
									<path d="M5 4h4l2 5l-2.5 1.5a11 11 0 0 0 5 5l1.5 -2.5l5 2v4a2 2 0 0 1 -2 2c-8.072 -.49 -14.51 -6.928 -15 -15a2 2 0 0 1 2 -2" />
									<path d="M15 5h6" />
									<path d="M18.5 7.5l2.5 -2.5l-2.5 -2.5" />
								</svg>
								${number}
							</a>
						`;

						hotlineCardsContainer.appendChild(hotlineCard);
					});
				});
			});
		});


		document.addEventListener('keydown', (event) => {
			if (event.key === 'Enter') {
				searchBtn.click();
			}
		});


		searchField.addEventListener('input', () => {
			if (searchField.value.trim() === '' || searchField.value.trim() === ' ') {
				getHelplinesByCountry();
			} else {
				searchBtn.click();
			}
		});
	</script>
</body>

</html>